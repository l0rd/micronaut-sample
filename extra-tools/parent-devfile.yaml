schemaVersion: 2.2.0
metadata:
  name: universal-parent
components:
  - name: tooling-container
    attributes:
      controller.devfile.io/merge-contribution: true
    container:
      image: quay.io/devfile/universal-developer-image:latest
      memoryRequest: 2Gi
      memoryLimit: 8Gi
      cpuRequest: 1000m
      cpuLimit: 4000m
  - name: extra-tools-copy
    container:
      image: quay.io/mloriedo/extra-tools-sample:latest
      command:
        - /copy-extra-tools.sh
      volumeMounts:
        - name: extra-tools
          path: /extra-tools
      memoryLimit: 256Mi
      memoryRequest: 32Mi
      cpuLimit: 500m
      cpuRequest: 30m
  - name: extra-tools-start
    attributes:
      controller.devfile.io/container-contribution: true
    container:
      image: ignored
      volumeMounts:
        - name: extra-tools
          path: /extra-tools
      memoryLimit: 1024Mi
      memoryRequest: 256Mi
      cpuLimit: 500m
      cpuRequest: 30m
      env:
        - name: TESTCONTAINERS_HOST_OVERRIDE 
          value: tcp://127.0.0.1:2475
        - name: TESTCONTAINERS_RYUK_DISABLED 
          value: 'true'
        - name: TESTCONTAINERS_CHECKS_DISABLE
          value: 'true'
      endpoints:
        - exposure: none
          name: kubedock
          protocol: tcp
          targetPort: 2475
  - name: extra-tools
    volume: {}
commands:
  - id: extra-tools-copy-command
    apply:
      component: extra-tools-copy
  - id: extra-tools-start-command
    exec:
      component: extra-tools-start
      commandLine: nohup /extra-tools/start.sh > /extra-tools/start.log 2>&1 &
events:
  preStart:
    - extra-tools-copy-command
  postStart:
    - extra-tools-start-command